## Manual Testing Guide: Calendar Resource Identification Verification

**Objective:** To specifically verify that `resource_id` is consistently and correctly identified during event manipulation (especially drag-and-drop) in the "My Calendar" feature, ensuring the "Could not identify resource for event" error is resolved.

**Tester:** Human QA

**Date of Test:** YYYY-MM-DD

**Version/Branch:** (Specify code version or branch, ensuring all recent `app.py` and `static/js/calendar.js` changes are included)

---

**I. Testing Environment Setup:**

1.  **Deployment:** Ensure the absolute latest code changes are deployed to the testing environment. This includes the backend update to `/api/bookings/calendar` to provide `resource_id` and the frontend updates in `static/js/calendar.js` for processing and logging this `resource_id`.
2.  **Browser & Dev Tools:** Use a modern web browser (e.g., Chrome, Firefox). **Crucially, open the browser's developer console (usually F12) and clear it before starting each test action.** This will make it easier to isolate and analyze the relevant logs.
3.  **User Login:** Log in as a designated test user.
4.  **Navigation:** Navigate to the "My Calendar" page.
5.  **Test Data - User's Bookings:**
    *   Ensure the test user has at least 2-3 bookings visible on the calendar. The specific nature of these bookings (morning, afternoon, etc.) is less critical for this test guide than for the slot snapping tests, but having a few to interact with is key.
    *   Example:
        *   Booking 1: "My Test Event 1" on Resource A.
        *   Booking 2: "My Test Event 2" on Resource A.
        *   (If applicable) Booking 3: "My Test Event 3" on Resource B (if user has bookings on multiple resources).

---

**II. Test Cases:**

**Test Case 1: Verify `resource_id` in Initial Event Population from API**

*   **Action:**
    1.  Clear the browser console.
    2.  Load or refresh the "My Calendar" page.
    3.  Let the calendar events load.
*   **Console Check:**
    *   Filter the console logs for messages originating from `static/js/calendar.js`.
    *   Look for the series of logs generated by the `events` function within the `actualBookings` event source during the mapping of API data:
        *   `console.log('Mapping booking to event. Raw booking data:', ...);`
        *   `console.log('Created event object. Resource ID:', event.resource_id, 'ExtendedProps Resource ID:', event.extendedProps.resource_id);`
*   **Expected Outcome:**
    *   For each booking fetched from the API, the "Raw booking data" log **must** show a `resource_id` field with a valid ID (e.g., `resource_id: 1`).
    *   For each corresponding "Created event object" log:
        *   `event.resource_id` (the top-level one) **must** be populated with the correct ID from the raw data.
        *   `event.extendedProps.resource_id` **must** also be populated with the correct ID.
*   **Pass/Fail:**
*   **Failure Condition:** If `resource_id` is missing or undefined in the "Raw booking data" log, it indicates the backend change in `app.py` for `/api/bookings/calendar` is not effective or not deployed. If `resource_id` is present in raw data but missing from the `event.resource_id` or `event.extendedProps.resource_id` in the "Created event object" log, the issue is in the JavaScript mapping logic.
*   **Notes (if fail, copy relevant logs for one problematic event):**

---

**Test Case 2: Verify `resource_id` Retrieval During Event Drag-and-Drop**

*   **Action:**
    1.  Identify a test event on the calendar (e.g., "My Test Event 1").
    2.  Clear the browser console.
    3.  Drag this event and attempt to drop it onto a new date or time slot (the validity of the drop location for saving is not the primary concern here, but whether the `resource_id` is identified).
*   **Console Check (immediately after the drop action, before any alerts if the drop is invalid for other reasons):**
    *   Look for the initial logs from the `customEventDrop` function:
        *   `console.log('customEventDrop - Full event object received:', ...);`
        *   `console.log('customEventDrop - info.event.extendedProps:', ...);`
        *   `console.log('customEventDrop - info.event.getResources():', ...);`
        *   `console.log('customEventDrop - info.event.resource_id (top-level):', ...);`
    *   Then look for the logs indicating how `resourceId` was sourced:
        *   E.g., `console.log('customEventDrop - Resource ID from extendedProps:', resourceId);`
        *   `console.log('customEventDrop - final retrieved resourceId after checks:', resourceId);`
*   **Expected Outcome:**
    *   The "Full event object received" log should show an event structure where:
        *   `resource_id` is present and correct at the top level of the event object.
        *   `extendedProps` exists and contains a correct `resource_id`.
    *   The subsequent logs should confirm that `resourceId` was successfully retrieved (e.g., "Resource ID from extendedProps: 1" or "Resource ID from top-level event.resource_id: 1").
    *   The "final retrieved resourceId after checks" should show a valid ID.
    *   The alert "Could not identify the resource for this booking. Operation cancelled." **should NOT appear**.
    *   The drag operation should proceed to either save successfully (if dropped on a valid, available slot) or be reverted due to slot availability rules (with the appropriate alert for that), but **NOT** due to a failure to identify the resource ID.
*   **Pass/Fail:**
*   **Repeat:** Perform this test for at least 2-3 different events if possible.
*   **Failure Condition:** The "Could not identify resource..." alert appears. Or, if the logs show that `resource_id` is `null` or `undefined` in all checked locations within the `info.event` object at the start of `customEventDrop`.
*   **Notes (if fail, copy the block of `customEventDrop` initial logs):**

---

**Test Case 3: Verify `resource_id` Retrieval During Event Resize (Secondary Check)**

*   **Action:**
    1.  Identify a test event on the calendar.
    2.  Clear the browser console.
    3.  Attempt to resize the event by dragging its start or end handle.
*   **Console Check (immediately after initiating the resize and releasing the mouse, before any alerts if the resize is invalid):**
    *   Look for the initial logs from the `customEventResize` function (these were not explicitly added in the last step but the `resourceId` retrieval pattern is similar):
        *   `console.log('customEventResize: event object:', ...);`
        *   `console.log('customEventResize: retrieved resourceId:', ...);`
*   **Expected Outcome:**
    *   Similar to Test Case 2, the logs should show that `resourceId` is correctly identified from the event object.
    *   The alert "Could not identify the resource for this booking. Operation cancelled." **should NOT appear**.
    *   The resize operation should proceed to either save successfully or be reverted due to slot validation rules, but **NOT** due to a missing resource ID.
*   **Pass/Fail:**
*   **Failure Condition:** The "Could not identify resource..." alert appears. Or, logs indicate `resourceId` is `null` or `undefined`.
*   **Notes (if fail, copy relevant logs):**

---

**IV. Overall Test Reporting:**

*   **Primary Goal:** Confirm that the "Could not identify resource for this booking. Operation cancelled." alert does **not** appear during any event drag or resize operation.
*   **Secondary Goal:** Confirm through console logs that `resource_id` is present in the event data from the initial load (Test Case 1) and is correctly retrieved in `customEventDrop` (Test Case 2) and `customEventResize` (Test Case 3).

*   **Overall Result (Pass/Fail):** (Pass only if all test cases pass, especially regarding the absence of the specific alert and correct `resource_id` logging)
*   **Summary of Findings:**
*   **Bugs/Issues Found (if any, with reference to Test Case #):**

---

**End of Test Guide**
