{% extends "base.html" %}
{% import '_pagination_controls.html' as pagination_macros with context %} {# IMPORT ADDED HERE #}

{% block title %}{{ _('My Bookings') }} - {{ super() }}{% endblock %}

{% block header %}
    {% include 'header_nav.html' %}
{% endblock %}

{% block content %}
<main class="container mt-4">
    <h2>{{ _('My Bookings') }}</h2>
    <hr>

    <div id="my-bookings-status" class="alert" style="display:none;" role="alert"></div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="status-filter-my-bookings" class="form-label">{{ _('Filter by Status:') }}</label>
            <select id="status-filter-my-bookings" class="form-select form-select-sm">
                <option value="">{{ _('All Statuses') }}</option>
                <option value="approved">{{ _('Approved') }}</option>
                <option value="pending_approval">{{ _('Pending Approval') }}</option>
                <option value="checked_in">{{ _('Checked In') }}</option>
                <option value="completed">{{ _('Completed') }}</option>
                <option value="cancelled">{{ _('Cancelled') }}</option>
                <option value="rejected">{{ _('Rejected') }}</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="resource-name-filter" class="form-label">{{ _('Filter by Resource Name:') }}</label>
            <input type="text" id="resource-name-filter" class="form-control form-control-sm" placeholder="{{ _('Enter resource name...') }}">
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button id="apply-my-bookings-filters-btn" class="btn btn-primary btn-sm me-2">{{ _('Apply Filters') }}</button>
            <button id="clear-my-bookings-filters-btn" class="btn btn-secondary btn-sm">{{ _('Clear Filters') }}</button>
        </div>
    </div>


    <div id="my-bookings-list">
        <div id="upcoming-bookings-section">
            <div class="d-flex justify-content-between align-items-center">
                <h3>{{ _('Upcoming Bookings') }}</h3>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="toggle-upcoming-bookings" checked>
                    <label class="form-check-label" for="toggle-upcoming-bookings">{{ _('Show') }}</label>
                </div>
            </div>
            
            {# UPCOMING BOOKINGS PAGINATION CONTROLS ADDED HERE #}
            {{ pagination_macros.render_js_pagination_controls('upcoming_bk_pg_') }}

            {# SCROLLABLE CLASS ADDED TO CONTAINER #}
            <div id="upcoming-bookings-container" class="list-group scrollable-table-container">
                <!-- Upcoming bookings will be loaded here by JavaScript -->
                <p class="loading-message list-group-item">{{ _('Loading upcoming bookings...') }}</p>
            </div>
        </div>

        <hr class="my-4">

        <div id="past-bookings-section" class="mt-3">
             <div class="d-flex justify-content-between align-items-center">
                <h3>{{ _('Past Bookings') }}</h3>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="toggle-past-bookings" checked>
                    <label class="form-check-label" for="toggle-past-bookings">{{ _('Show') }}</label>
                </div>
            </div>

            {# PAST BOOKINGS PAGINATION CONTROLS ADDED HERE #}
            {{ pagination_macros.render_js_pagination_controls('past_bk_pg_') }}

            {# SCROLLABLE CLASS ADDED TO CONTAINER #}
            <div id="past-bookings-container" class="list-group scrollable-table-container">
                <!-- Past bookings will be loaded here by JavaScript -->
                <p class="loading-message list-group-item">{{ _('Loading past bookings...') }}</p>
            </div>
        </div>
    </div>

    <!-- Template for a single booking item (hidden, used by JS) -->
    <div id="booking-item-template" style="display: none;" class="list-group-item list-group-item-action booking-card">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1 booking-title-display">
                <span class="booking-title-text"></span>
                <button class="btn btn-sm btn-link edit-title-btn p-0 ms-1" aria-label="{{ _('Edit Title') }}">✏️</button>
            </h5>
            <small class="booking-id-display">ID: #</small>
        </div>
        <p class="mb-1">
            <strong class="booking-resource-label">{{ _('Resource:') }}</strong> <span class="booking-resource"></span>
        </p>
        <p class="mb-1">
            <strong class="booking-time-label">{{ _('Time:') }}</strong>
            <span class="booking-start-time"></span> - <span class="booking-end-time"></span>
            (<span class="booking-date"></span>)
        </p>
        <p class="mb-1">
            <strong class="booking-status-label">{{ _('Status:') }}</strong> <span class="booking-status badge"></span>
        </p>
        <div class="booking-pin-section" style="display: none;">
             <p class="mb-1">
                <strong class="booking-pin-label">{{ _('PIN:') }}</strong> <span class="booking-pin"></span>
            </p>
        </div>
        <div class="booking-actions mt-2">
            <!-- Buttons will be dynamically added here by JS -->
        </div>
        <div class="admin-deleted-message-section mt-2" style="display:none;">
            <div class="alert alert-warning p-2 small" role="alert">
                <strong>{{ _('Admin Cancellation Reason:') }}</strong>
                <p class="admin-deleted-message-text mb-0"></p>
            </div>
        </div>
    </div>

    <!-- Modal for Updating Booking Title -->
    <div class="modal fade" id="update-booking-modal" tabindex="-1" aria-labelledby="updateBookingModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="updateBookingModalLabel">{{ _('Update Booking Title') }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ _('Close') }}"></button>
          </div>
          <div class="modal-body">
            <form id="update-booking-title-form">
              <input type="hidden" id="update-booking-id-input">
              <div class="mb-3">
                <label for="new-booking-title-input" class="form-label">{{ _('New Title:') }}</label>
                <input type="text" class="form-control" id="new-booking-title-input" required>
              </div>
              <button type="submit" class="btn btn-primary">{{ _('Save Changes') }}</button>
            </form>
            <div id="update-booking-modal-status" class="mt-2"></div>
          </div>
        </div>
      </div>
    </div>

</main>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/my_bookings.js') }}" defer></script>
{% endblock %}
