{% extends "base.html" %}

{% block title %}{{ _('My Bookings') }} - {{ super() }}{% endblock %}

{% block header %}
    {% include 'header_nav.html' %}
{% endblock %}

{% block content %}
<main class="container mt-4">
    <h2>{{ _('My Bookings') }}</h2>
    <hr>

    <div id="my-bookings-status" class="alert" style="display:none;"></div>

    <div id="my-bookings-list">
        <!-- Bookings will be loaded here by JavaScript -->
        <p>{{ _('Loading your bookings...') }}</p>
    </div>

    <!-- Template for a single booking item (hidden, used by JS) -->
    <template id="booking-item-template">
        <div class="card mb-3 booking-item">
            <div class="card-body">
                <h5 class="card-title resource-name"></h5>
                <p class="card-text">
                    <strong>{{ _('Title') }}:</strong> <span class="booking-title"></span><br>
                    <strong>{{ _('Starts') }}:</strong> <span class="start-time"></span><br>
                    <strong>{{ _('Ends') }}:</strong> <span class="end-time"></span><br>
                    <strong>{{ _('Recurrence') }}:</strong> <span class="recurrence-rule"></span>
                </p>
                <button class="btn btn-sm btn-primary update-booking-btn" data-booking-id="">{{ _('Update Booking') }}</button>
                <button class="btn btn-sm btn-danger cancel-booking-btn" data-booking-id="">{{ _('Cancel Booking') }}</button>
                <button class="btn btn-sm btn-success check-in-btn" data-booking-id="" style="display:none;">{{ _('Check In') }}</button>
                <button class="btn btn-sm btn-secondary check-out-btn" data-booking-id="" style="display:none;">{{ _('Check Out') }}</button>
            </div>
        </div>
    </template>

    {% include '_booking_modal.html' %}

</main>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        // Make username available to scripts
        // Ideally, this would be on the body tag in base.html: <body data-user-name="{{ current_user.username }}">
        // Adding it here to fulfill dependency for booking_modal_handler.js and my_bookings.js
        {% if current_user and current_user.is_authenticated %}
            document.body.dataset.userName = "{{ current_user.username }}";
        {% else %}
            document.body.dataset.userName = ""; // Set to empty if no user or not authenticated
        {% endif %}
    </script>
    <script src="{{ url_for('static', filename='js/booking_modal_handler.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/my_bookings.js') }}" defer></script>
{% endblock %}
