{% extends "base.html" %}

{% block title %}{{ _('Smart Resource Booking - New Booking') }}{% endblock %}

{% block content %}
    <h1>{{ _('Create New Booking') }}</h1>

    <div class="map-controls">
        <div>
            <label for="new-booking-map-availability-date">{{ _('View Availability for Date:') }}</label>
            <input type="date" id="new-booking-map-availability-date" name="map-availability-date">
        </div>
        <div>
            <label for="new-booking-map-location-select">{{ _('Location:') }}</label>
            <select id="new-booking-map-location-select"></select>
            <label for="new-booking-map-floor-select">{{ _('Floor:') }}</label>
            <select id="new-booking-map-floor-select"></select>
        </div>
    </div>
    <div id="new-booking-map-container" style="position: relative; width: 800px; height: 600px; background-size: contain; background-repeat: no-repeat; background-position: center center; border: 1px solid #ccc; margin-bottom: 20px;">
        <!-- Map image and resource areas will be loaded here by JavaScript -->
    </div>
    <div id="new-booking-map-loading-status">{{ _('Loading map and resources...') }}</div>

    <div id="new-booking-message" aria-live="polite" style="margin-bottom: 15px;"></div>
    <form id="booking-form">
        <div>
            <label for="resource-select-booking">{{ _('Resource:') }}</label>
            <select id="resource-select-booking" name="resource_id">
                <option value="">{{ _('Loading resources...') }}</option>
            </select>
        </div>
        <div>
            <label for="booking-date">{{ _('Date:') }}</label>
            <input type="date" id="booking-date" name="booking_date">
        </div>
        <div>
            <input type="checkbox" id="enable-recurrence">
            <label for="enable-recurrence">{{ _('Repeat Booking') }}</label>
            <select id="recurrence-rule" name="recurrence_rule" disabled>
                <option value="">{{ _('Select recurrence') }}</option>
                <option value="FREQ=DAILY;COUNT=3">{{ _('Daily for 3 days') }}</option>
                <option value="FREQ=WEEKLY;COUNT=3">{{ _('Weekly for 3 weeks') }}</option>
            </select>
        </div>
        <div>
            <fieldset>
                <legend>{{ _('Quick Time Options') }}</legend>
                <div>
                    <input type="radio" id="time-option-morning" name="quick_time_option" value="morning" checked>
                    <label for="time-option-morning">{{ _('First Half-Day (09:00-13:00)') }}</label>
                </div>
                <div>
                    <input type="radio" id="time-option-afternoon" name="quick_time_option" value="afternoon">
                    <label for="time-option-afternoon">{{ _('Second Half-Day (14:00-18:00)') }}</label>
                </div>
                <div>
                    <input type="radio" id="time-option-full-day" name="quick_time_option" value="full_day">
                    <label for="time-option-full-day">{{ _('Full Day (09:00-18:00)') }}</label>
                </div>
            </fieldset>
        </div>
        <button type="submit">{{ _('Find Availability') }}</button>
    </form>
    <div id="booking-results" aria-live="polite"></div>

    <!-- Modal for displaying resource details (copied and adapted from map_view.html) -->
    <div id="new-booking-time-slot-modal" class="modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="new-booking-modal-title">
        <div class="modal-content">
            <span id="new-booking-close-modal-btn" class="close-modal-btn" role="button" aria-label="{{ _('Close modal') }}">&times;</span>
            <h3 id="new-booking-modal-title">{{ _('Resource Details') }}</h3>
            <p>{{ _('Resource:') }} <strong id="new-booking-modal-resource-name">N/A</strong></p>
            <img id="new-booking-modal-resource-image" src="#" alt="{{ _('Resource image') }}" style="max-width:100%; display:none; margin-bottom:5px;">
            <p>{{ _('Date:') }} <strong id="new-booking-modal-date">N/A</strong></p>
            
            <div id="new-booking-modal-time-slots-list" class="time-slots-container">
                <!-- Time slots will be dynamically inserted here by JavaScript -->
            </div>
            
            <div>
                <label for="new-booking-modal-booking-title">{{ _('Booking Title (optional):') }}</label>
                <input type="text" id="new-booking-modal-booking-title" name="booking_title" class="form-control"> {# Added form-control for styling if using Bootstrap-like CSS #}
            </div>
            
            <button id="new-booking-modal-confirm-booking-btn" class="button">{{ _('Confirm Booking') }}</button>
            <p id="new-booking-modal-status-message" style="margin-top:10px;"></p>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }} {# Ensures scripts from base.html are included #}
    <script src="{{ url_for('static', filename='js/new_booking_map.js') }}" defer></script>
{% endblock %}
