{% extends "base.html" %}

{% block title %}{{ _('System Troubleshooting Tools') }}{% endblock %}

{% block content %} {# Adjusted from page_content to content #}
<div class="container-fluid"> {# Or container mt-4 if that's preferred for admin pages #}
    <div class="row">
        <div class="col-lg-12">
            {# Assuming page-header is a valid class, or use a simple h1 #}
            <h1 class="page-header">{{ _('System Troubleshooting Tools') }}</h1>
            <hr>
            <section id="troubleshooting-tools-section" class="mb-5">
                <h2>{{ _('System Troubleshooting Tools') }}</h2>

                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">{{ _('Browse Database Tables') }}</h5>
                        <p class="card-text">{{ _('Select a table to view its columns, filter records, and browse data with pagination.') }}</p>

                        <div class="mb-3">
                            <label for="db-table-select" class="form-label">{{ _('Select Table:') }}</label>
                            <select id="db-table-select" class="form-select">
                                <option value="">{{ _('-- Loading tables... --') }}</option>
                            </select>
                        </div>

                        <div id="db-filter-area" class="mb-3" style="display: none;">
                            <h5>{{ _('Filters') }}</h5>
                            <div id="db-filter-controls-container" class="row">
                                <div id="db-filter-col-1" class="col-md-6"></div>
                                <div id="db-filter-col-2" class="col-md-6"></div>
                            </div>
                            <button id="db-apply-filters-btn" class="btn btn-primary mt-2">{{ _('Apply Filters') }}</button>
                            <button id="db-clear-filters-btn" class="btn btn-secondary mt-2">{{ _('Clear Filters') }}</button>
                        </div>

                        <div id="db-results-area" class="mt-3">
                            <h5>{{ _('Records') }}</h5>
                            {# SCROLLABLE CONTAINER ADDED HERE #}
                            <div class="scrollable-table-container">
                                <div id="db-records-output" style="max-height: none; overflow-y: visible;"> {# Removed inline style conflicting with class #}
                                    <p>{{ _('Select a table and apply filters to view records.') }}</p>
                                    <!-- Table will be dynamically generated here -->
                                </div>
                            </div>
                        </div>

                        {# PAGINATION CONTROLS STRUCTURE MODIFIED HERE #}
                        <div id="db-pagination-controls" class="pagination-controls-container d-flex justify-content-between align-items-center my-3" style="display: none;">
                            <div class="results-per-page-container">
                                <label for="db-per-page-select" class="me-2">{{ _('Results') }}</label>
                                <select id="db-per-page-select" class="form-select form-select-sm d-inline-block" style="width: auto;">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <span class="ms-2">{{ _('per page') }}</span>
                                <span id="db-total-results-display" class="ms-3 text-muted"></span>
                            </div>
                            <nav aria-label="Table navigation">
                                <ul id="db-pagination-ul" class="pagination pagination-sm mb-0">
                                    <!-- Page links will be dynamically added here by renderPagination JS function -->
                                </ul>
                            </nav>
                        </div>

                        <div id="db-view-status" class="mt-2"></div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">{{ _('Reload Configurations') }}</h5>
                        <p class="card-text">{{ _('Attempt to reload system configurations like the backup schedule and map data. Note: Full effect may require deeper application integration for some configurations.') }}</p>
                        <button id="reload-configurations-btn" class="btn btn-warning">{{ _('Reload Configurations') }}</button>
                        <div id="reload-configurations-status" class="mt-2"></div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">{{ _('Cleanup System Data') }}</h5>
                        <p class="card-text text-danger"><strong>{{ _('Warning:') }}</strong> {{ _('This will delete all bookings, resources, and floor maps from the database, and remove all uploaded floor map and resource images. This action is irreversible.') }}</p>
                        <button id="cleanup-system-data-btn" class="btn btn-danger">{{ _('Cleanup System Data') }}</button>
                        <div id="cleanup-system-data-status" class="mt-2"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
    // CSRF token will be handled by the global apiCall function.

    // --- New Database Browser UI Elements & Logic ---
    const dbTableSelect = document.getElementById('db-table-select');
    const dbFilterArea = document.getElementById('db-filter-area');
    const dbFilterControlsContainer = document.getElementById('db-filter-controls-container');
    const dbApplyFiltersBtn = document.getElementById('db-apply-filters-btn');
    const dbClearFiltersBtn = document.getElementById('db-clear-filters-btn');
    const dbResultsArea = document.getElementById('db-results-area');
    const dbRecordsOutput = document.getElementById('db-records-output');
    const dbPaginationControls = document.getElementById('db-pagination-controls');
    const dbViewStatusEl = document.getElementById('db-view-status');
    const dbPerPageSelect = document.getElementById('db-per-page-select');
    const dbTotalResultsDisplay = document.getElementById('db-total-results-display');
    const dbPaginationUl = document.getElementById('db-pagination-ul');

    const dbItemsPerPageOptions = [10, 25, 50, 100, 200];

    let dbViewState = {
        selectedTable: null,
        currentPage: 1,
        currentFilters: [],
        columns: [],
        perPage: dbItemsPerPageOptions[0], // Use first option as default
        sortBy: null,
        sortOrder: 'asc'
    };

    function updateDbViewStatus(message, isError = false) {
        if (!dbViewStatusEl) return;
        dbViewStatusEl.textContent = message;
        dbViewStatusEl.className = `alert ${isError ? 'alert-danger' : 'alert-success'}`;
        if (!message) {
            dbViewStatusEl.style.display = 'none';
        } else {
            dbViewStatusEl.style.display = 'block';
        }
    }

    async function loadTableNames() {
        updateDbViewStatus("{{ _('Loading table names...') }}");
        try {
            const response = await fetch('/api/admin/db/table_names');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            console.log('API response for table names:', JSON.stringify(data, null, 2));

            if (data.success && data.tables) {
                dbTableSelect.innerHTML = '<option value="">{{ _("-- Select a Table --") }}</option>';

                data.tables.sort((a, b) => a.name.localeCompare(b.name));

                data.tables.forEach(tableInfo => {
                    const option = document.createElement('option');
                    option.value = tableInfo.name;
                    const recordText = tableInfo.count === 1 ? 'record' : 'records';
                    option.textContent = `${tableInfo.name} (${tableInfo.count} ${recordText})`;
                    dbTableSelect.appendChild(option);
                });
                updateDbViewStatus("{{ _('Table names loaded.') }}", false);
                console.log('Generated dbTableSelect HTML:', dbTableSelect.innerHTML);
            } else {
                throw new Error(data.message || "{{ _('Failed to load table names.') }}");
            }
        } catch (error) {
            console.error('Error loading table names:', error);
            updateDbViewStatus(`{{ _('Error loading table names:') }} ${error.message}`, true);
            dbTableSelect.innerHTML = '<option value="">{{ _("-- Error loading tables --") }}</option>';
        }
    }

    async function loadTableInfoAndGenerateFilters(tableName) {
        if (!tableName) {
            dbFilterArea.style.display = 'none';
            dbFilterControlsContainer.innerHTML = `<p>{{ _('Select a table to see available filters.') }}</p>`;
            dbViewState.columns = [];
            return;
        }
        updateDbViewStatus(`{{ _('Loading schema for table:') }} ${tableName}...`);
        dbFilterArea.style.display = 'block';

        const dbFilterCol1 = document.getElementById('db-filter-col-1');
        const dbFilterCol2 = document.getElementById('db-filter-col-2');

        if (!dbFilterCol1 || !dbFilterCol2) {
            console.error('CRITICAL: Filter column elements (db-filter-col-1 or db-filter-col-2) are null/not found in DOM immediately after getElementById within loadTableInfoAndGenerateFilters.');
            if (typeof updateDbViewStatus === 'function') {
                updateDbViewStatus('Internal UI error: Filter layout components are missing. Please try refreshing.', true);
            }
            return;
        }

        dbFilterCol1.innerHTML = `<p>{{ _('Loading filters for ') }}${tableName}...</p>`;
        dbFilterCol2.innerHTML = '';

        try {
            const response = await fetch(`/api/admin/db/table_info/${tableName}`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();

            if (data.success && data.columns) {
                dbViewState.columns = data.columns;
                dbFilterCol1.innerHTML = '';
                dbFilterCol2.innerHTML = '';

                if (data.columns.length === 0) {
                    dbFilterCol1.innerHTML = `<p>{{ _('No filterable columns found for this table.') }}</p>`;
                }

                data.columns.forEach((column, index) => {
                    const filterGroup = document.createElement('div');
                    filterGroup.className = 'mb-3 filter-group-item';
                    filterGroup.innerHTML = `
                        <div><label class="form-label mb-1">${column.name} <small class="text-muted">(${column.type})</small></label></div>
                        <div class="input-group input-group-sm mb-1">
                            <select class="form-select filter-op" data-column="${column.name}">
                                <option value="">{{ _('-- Operator --') }}</option>
                                <option value="eq">{{ _('Equals') }} (=)</option>
                                <option value="neq">{{ _('Not Equals') }} (!=)</option>
                                <option value="ilike">{{ _('Contains (case-insensitive)') }}</option>
                                <option value="gt">{{ _('Greater Than') }} (&gt;)</option>
                                <option value="gte">{{ _('Greater Than or Equal To') }} (&gt;=)</option>
                                <option value="lt">{{ _('Less Than') }} (&lt;)</option>
                                <option value="lte">{{ _('Less Than or Equal To') }} (&lt;=)</option>
                                <option value="in">{{ _('In (comma-separated)') }}</option>
                                <option value="notin">{{ _('Not In (comma-separated)') }}</option>
                                <option value="is_null">{{ _('Is Null') }}</option>
                                <option value="is_not_null">{{ _('Is Not Null') }}</option>
                            </select>
                            <input type="text" class="form-control filter-val" data-column="${column.name}" placeholder="{{ _('Value') }}">
                        </div>
                    `;

                    const opSelect = filterGroup.querySelector('.filter-op');
                    const valInput = filterGroup.querySelector('.filter-val');
                    opSelect.addEventListener('change', function() {
                        if (this.value === 'is_null' || this.value === 'is_not_null') {
                            valInput.style.display = 'none';
                            valInput.value = '';
                        } else {
                            valInput.style.display = 'block';
                        }
                    });

                    if (index % 2 === 0) {
                        dbFilterCol1.appendChild(filterGroup);
                    } else {
                        dbFilterCol2.appendChild(filterGroup);
                    }
                });
                updateDbViewStatus(`{{ _('Schema loaded for table:') }} ${tableName}. {{ _('Ready for filtering and data fetching.') }}`, false);
            } else {
                throw new Error(data.message || `{{ _('Failed to load schema for table:') }} ${tableName}`);
            }
        } catch (error) {
            console.error(`Error loading table info for ${tableName}:`, error);
            updateDbViewStatus(`{{ _('Error loading schema for') }} ${tableName}: ${error.message}`, true);
            dbFilterArea.style.display = 'none';
            dbFilterControlsContainer.innerHTML = `<p class="text-danger">{{ _('Error loading filters.') }}</p>`;
        }
    }

    function renderTable(columns, records) {
        dbRecordsOutput.innerHTML = '';
        if (!columns || columns.length === 0) {
             dbRecordsOutput.innerHTML = `<p>{{ _('No column information available to display table.') }}</p>`;
             return;
        }
        if (!records || records.length === 0) {
            dbRecordsOutput.innerHTML = `<p>{{ _('No records found for the current selection and filters.') }}</p>`;
            return;
        }

        const table = document.createElement('table');
        table.className = 'table table-striped table-bordered table-sm caption-top';

        const caption = table.createCaption();
        caption.textContent = `${dbViewState.selectedTable} - {{ _('Page') }} ${dbViewState.currentPage}`;


        const thead = table.createTHead();
        const headerRow = thead.insertRow();
        columns.forEach(colDef => {
            const th = document.createElement('th');
            th.scope = 'col';
            th.textContent = colDef.name;
            let sortIndicator = '';
            if (dbViewState.sortBy === colDef.name) {
                sortIndicator = dbViewState.sortOrder === 'asc' ? ' &uarr;' : ' &darr;';
            }
            th.innerHTML = colDef.name + sortIndicator;
            th.style.cursor = 'pointer';
            th.addEventListener('click', () => {
                if (dbViewState.sortBy === colDef.name) {
                    dbViewState.sortOrder = dbViewState.sortOrder === 'asc' ? 'desc' : 'asc';
                } else {
                    dbViewState.sortBy = colDef.name;
                    dbViewState.sortOrder = 'asc';
                }
                fetchAndDisplayTableData();
            });
            headerRow.appendChild(th);
        });

        const tbody = table.createTBody();
        records.forEach(record => {
            const row = tbody.insertRow();
            columns.forEach(colDef => {
                const cell = row.insertCell();
                let value = record[colDef.name];
                if (value === null || typeof value === 'undefined') {
                    cell.textContent = 'NULL';
                    cell.classList.add('text-muted', 'fst-italic');
                } else if (typeof value === 'object') {
                    cell.textContent = JSON.stringify(value, null, 2);
                } else {
                    cell.textContent = value;
                }
            });
        });
        dbRecordsOutput.appendChild(table);
    }

    function renderPagination(paginationData) {
        // const dbPaginationUl = document.getElementById('db-pagination-ul'); // Already global
        if (!dbPaginationUl) return;
        dbPaginationUl.innerHTML = ''; // Clear only the page links list

        if (!paginationData || paginationData.total_pages <= 0) {
            dbPaginationControls.style.display = 'none';
            if(dbTotalResultsDisplay) dbTotalResultsDisplay.textContent = '';
            return;
        }
        dbPaginationControls.style.display = 'flex'; // Use flex for the main container

        if(dbTotalResultsDisplay) {
            // Use total_items from paginationData (corrected from total_records)
            dbTotalResultsDisplay.textContent = `Total: ${paginationData.total_items} records`;
        }

        let pageLinksHtml = '';

        // Previous button - use paginationData.current_page
        pageLinksHtml += `<li class="page-item ${paginationData.current_page === 1 ? 'disabled' : ''}">
                            <a class="page-link" href="#" data-page="${paginationData.current_page - 1}">${("{{ _('Previous') }}")}</a>
                          </li>`;

        let show_pages_count = 5;
        let start_p = Math.max(1, paginationData.current_page - Math.floor(show_pages_count / 2));
        let end_p = Math.min(paginationData.total_pages, start_p + show_pages_count - 1);
        if (end_p - start_p + 1 < show_pages_count) {
            start_p = Math.max(1, end_p - show_pages_count + 1);
        }

        if (start_p > 1) {
             pageLinksHtml += `<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>`;
             if (start_p > 2) pageLinksHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        for (let i = start_p; i <= end_p; i++) {
            pageLinksHtml += `<li class="page-item ${i === paginationData.current_page ? 'active' : ''}"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
        }
        if (end_p < paginationData.total_pages) {
            if (end_p < paginationData.total_pages - 1) pageLinksHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            pageLinksHtml += `<li class="page-item"><a class="page-link" href="#" data-page="${paginationData.total_pages}">${paginationData.total_pages}</a></li>`;
        }

        // Next button - use paginationData.current_page
        pageLinksHtml += `<li class="page-item ${paginationData.current_page === paginationData.total_pages ? 'disabled' : ''}">
                            <a class="page-link" href="#" data-page="${paginationData.current_page + 1}">${("{{ _('Next') }}")}</a>
                          </li>`;

        dbPaginationUl.innerHTML = pageLinksHtml;

        dbPaginationUl.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (this.closest('li').classList.contains('disabled')) return;
                const pageNum = parseInt(this.dataset.page);
                if (pageNum && pageNum !== dbViewState.currentPage) {
                    handlePaginationClick(pageNum);
                }
            });
        });
    }

    function initializeDbPerPageSelect() {
        if (!dbPerPageSelect) return;
        dbPerPageSelect.innerHTML = '';
        dbItemsPerPageOptions.forEach(optionValue => {
            const option = new Option(optionValue, optionValue);
            if (optionValue === dbViewState.perPage) {
                option.selected = true;
            }
            dbPerPageSelect.add(option);
        });
        dbPerPageSelect.addEventListener('change', function() {
            dbViewState.perPage = parseInt(this.value);
            dbViewState.currentPage = 1;
            fetchAndDisplayTableData();
        });
    }

    async function handlePaginationClick(newPage) {
        if (newPage < 1) return;
        dbViewState.currentPage = newPage;
        await fetchAndDisplayTableData();
    }

    async function fetchAndDisplayTableData() {
        const { selectedTable, currentPage, currentFilters, perPage, sortBy, sortOrder } = dbViewState;

        if (!selectedTable) {
            dbRecordsOutput.innerHTML = `<p>{{ _('Please select a table first.') }}</p>`;
            dbPaginationControls.style.display = 'none';
            return;
        }

        const currentTableName = String(selectedTable);
        console.log('Fetching data for table:', currentTableName, 'Type:', typeof currentTableName);

        updateDbViewStatus(`{{ _('Fetching data for table:') }} ${currentTableName}, {{ _('page:') }} ${currentPage}...`);

        let queryParams = `page=${currentPage}&per_page=${perPage}`;
        if (currentFilters.length > 0) {
            queryParams += `&filters=${encodeURIComponent(JSON.stringify(currentFilters))}`;
        }
        if (sortBy) {
            queryParams += `&sort_by=${encodeURIComponent(sortBy)}&sort_order=${encodeURIComponent(sortOrder)}`;
        }

        try {
            const response = await fetch(`/api/admin/db/table_data/${currentTableName}?${queryParams}`);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ message: `HTTP error! status: ${response.status}` }));
                throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
            }
            const data = await response.json();

            if (data.success && data.records) {
                if (data.columns && dbViewState.columns.length === 0) {
                    dbViewState.columns = data.columns;
                }
                renderTable(dbViewState.columns, data.records);
                renderPagination(data.pagination); // data.pagination should have current_page, total_items, total_pages
                updateDbViewStatus(`{{ _('Data loaded for table:') }} ${currentTableName}.`, false);
            } else {
                throw new Error(data.message || `{{ _('Failed to fetch data for table:') }} ${currentTableName}`);
            }
        } catch (error) {
            console.error(`Error fetching table data for ${currentTableName}:`, error);
            updateDbViewStatus(`{{ _('Error fetching data for') }} ${currentTableName}: ${error.message}`, true);
            dbRecordsOutput.innerHTML = `<p class="text-danger">{{ _('Error loading records.') }}</p>`;
            dbPaginationControls.style.display = 'none';
        }
    }

    if (dbTableSelect) {
        dbTableSelect.addEventListener('change', async function(event) {
            dbViewState.selectedTable = event.target.value;
            console.log('dbTableSelect changed. Selected table name:', dbViewState.selectedTable, 'Type:', typeof dbViewState.selectedTable);
            dbViewState.currentPage = 1;
            dbViewState.currentFilters = [];
            dbViewState.columns = [];
            dbViewState.sortBy = null;
            dbViewState.sortOrder = 'asc';

            dbRecordsOutput.innerHTML = `<p>{{ _('Select a table and apply filters to view records.') }}</p>`;
            dbPaginationControls.style.display = 'none';

            if (dbViewState.selectedTable) {
                await loadTableInfoAndGenerateFilters(dbViewState.selectedTable);
                await fetchAndDisplayTableData();
            } else {
                dbFilterArea.style.display = 'none';
                const col1 = document.getElementById('db-filter-col-1');
                const col2 = document.getElementById('db-filter-col-2');
                if(col1) col1.innerHTML = `<p>{{ _('Select a table to see available filters.') }}</p>`;
                if(col2) col2.innerHTML = '';
            }
        });
    }

    if (dbApplyFiltersBtn) {
        dbApplyFiltersBtn.addEventListener('click', async function() {
            dbViewState.currentFilters = [];
            const filterItems = dbFilterControlsContainer.querySelectorAll('.filter-group-item');
            filterItems.forEach(item => {
                const opSelect = item.querySelector('.filter-op');
                const valInput = item.querySelector('.filter-val');
                const column = opSelect.dataset.column;
                const op = opSelect.value;
                let value = valInput.value;

                if (op) {
                    if (op === 'is_null' || op === 'is_not_null') {
                        dbViewState.currentFilters.push({ column, op, value: null });
                    } else if (value.trim() !== '') {
                         dbViewState.currentFilters.push({ column, op, value: value.trim() });
                    }
                }
            });
            dbViewState.currentPage = 1;
            await fetchAndDisplayTableData();
        });
    }

    if (dbClearFiltersBtn) {
        dbClearFiltersBtn.addEventListener('click', async function() {
            const filterItems = dbFilterControlsContainer.querySelectorAll('.filter-group-item');
            filterItems.forEach(item => {
                item.querySelector('.filter-op').value = '';
                const valInput = item.querySelector('.filter-val');
                valInput.value = '';
                valInput.style.display = 'block';
            });
            dbViewState.currentFilters = [];
            dbViewState.currentPage = 1;
            await fetchAndDisplayTableData();
        });
    }

    // Load initial table names
    loadTableNames();
    initializeDbPerPageSelect(); // Initialize the per-page select dropdown


    // --- End of New Database Browser UI Logic ---


    // Old Troubleshooting Tools Event Listeners (to be kept if they are for other cards)
    const reloadConfigurationsBtn = document.getElementById('reload-configurations-btn');
    const reloadConfigurationsStatusEl = document.getElementById('reload-configurations-status');

    const cleanupSystemDataBtn = document.getElementById('cleanup-system-data-btn');
    const cleanupSystemDataStatusEl = document.getElementById('cleanup-system-data-status');

    if (reloadConfigurationsBtn) {
        reloadConfigurationsBtn.addEventListener('click', function() {
            reloadConfigurationsStatusEl.textContent = "{{ _('Attempting to reload configurations...') }}";
            reloadConfigurationsStatusEl.className = 'alert alert-info';
            reloadConfigurationsBtn.disabled = true;

            apiCall('/api/admin/reload_configurations', {
                method: 'POST'
            }, reloadConfigurationsStatusEl)
            .then(data => {
                if (!data.message && data.success) {
                     showSuccess(reloadConfigurationsStatusEl, "{{ _('Configuration reload attempt finished successfully.') }}");
                }
            })
            .catch(error => {
                console.error('Reload Configurations error:', error);
            })
            .finally(() => {
                reloadConfigurationsBtn.disabled = false;
            });
        });
    }

    if (cleanupSystemDataBtn) {
        cleanupSystemDataBtn.addEventListener('click', function() {
            const confirmationPrompt = "{{ _('Type CONFIRM to delete bookings, resources, floor maps, and all uploaded floor map/resource images. This action is irreversible.') }}";
            const userInput = prompt(confirmationPrompt);

            if (userInput === "CONFIRM") {
                cleanupSystemDataStatusEl.textContent = "{{ _('Processing cleanup...') }}";
                cleanupSystemDataStatusEl.className = 'alert alert-info';
                cleanupSystemDataBtn.disabled = true;

                apiCall('/api/admin/cleanup_system_data', {
                    method: 'POST'
                }, cleanupSystemDataStatusEl)
                .then(data => {
                     if (!data.message && data.success) {
                        showSuccess(cleanupSystemDataStatusEl, "{{ _('System data cleanup successful.') }}");
                     }
                })
                .catch(error => {
                    console.error('Cleanup System Data error:', error);
                })
                .finally(() => {
                    cleanupSystemDataBtn.disabled = false;
                });
            } else if (userInput !== null) {
                cleanupSystemDataStatusEl.textContent = "{{ _('Cleanup cancelled. Confirmation not received.') }}";
                cleanupSystemDataStatusEl.className = 'alert alert-warning';
            } else {
                 cleanupSystemDataStatusEl.textContent = "{{ _('Cleanup cancelled.') }}";
                 cleanupSystemDataStatusEl.className = 'alert alert-info';
            }
        });
    }
});
</script>
{% endblock %}
