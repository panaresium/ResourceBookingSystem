<!doctype html>
<html lang="{{ g.get('locale', 'en') }}">
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}{{ _('Smart Resource Booking') }}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block head_extra %}{% endblock %}
</head>
<body class="with-sidebar sidebar-collapsed">
    <nav id="sidebar" class="collapsed">
        <button id="sidebar-toggle" aria-label="{{ _('Toggle menu') }}">&#9776;</button>
        <ul>
            <li><a href="{{ url_for('serve_index') }}"><span class="menu-icon" aria-hidden="true">üè†</span><span class="menu-text">{{ _('Home') }}</span></a></li>
            <li><a href="{{ url_for('serve_new_booking') }}"><span class="menu-icon" aria-hidden="true">üÜï</span><span class="menu-text">{{ _('New Booking') }}</span></a></li>
            <li><a href="{{ url_for('serve_resources') }}"><span class="menu-icon" aria-hidden="true">üìÅ</span><span class="menu-text">{{ _('View Resources') }}</span></a></li>
            <li><a href="{{ url_for('serve_calendar') }}"><span class="menu-icon" aria-hidden="true">üìÖ</span><span class="menu-text">{{ _('Calendar') }}</span></a></li>
            
            {# General links visible to all - JavaScript will manage the display of login/logout and user info #}

            {# Container for the 'Login' link - shown by JS when logged out #}
            <li id="auth-link-container" style="display: none; margin-left:auto;">
                <a href="{{ url_for('serve_login') }}"><span class="menu-icon" aria-hidden="true">üîë</span><span class="menu-text">{{ _('Login') }}</span></a>
            </li>

            {# Container for 'My Bookings' - shown by JS when logged in #}
            <li id="my-bookings-nav-link" style="display: none;">
                 <a href="{{ url_for('serve_my_bookings_page') }}"><span class="menu-icon" aria-hidden="true">üìñ</span><span class="menu-text">{{ _('My Bookings') }}</span></a>
            </li>
            
            {# Container for Admin Maps link - shown by JS if admin #}
        <li id="admin-menu-item" style="display:none;">
            <details id="admin-section">
                <summary><span class="menu-icon" aria-hidden="true">‚öôÔ∏è</span><span class="menu-text">{{ _('Admin') }}</span></summary>
                <ul class="admin-menu">
                <li id="admin-maps-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_admin_maps') }}">{{ _('Admin Maps') }}</a>
                </li>
                <li id="resource-management-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_resource_management_page') }}">{{ _('Resource Management') }}</a>
                </li>
                <li id="user-management-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_user_management_page') }}">{{ _('User Management') }}</a>
                </li>
                <li id="log-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_audit_log_page') }}">{{ _('Audit Logs') }}</a>
                </li>
                <li id="analytics-nav-link" style="display: none;">
                    <a href="{{ url_for('analytics.analytics_dashboard') }}">{{ _('Analytics') }}</a>
                </li>
                <li id="manual-backup-nav-link" style="display:none;">
                    <button class="button" id="manual-backup-btn" type="button">{{ _('Manual Sync') }}</button>
                </li>
                </ul>
            </details>
        </li>

            <li>
                <button id="theme-toggle" type="button"><span class="menu-icon" aria-hidden="true">üåì</span><span class="menu-text">{{ _('Toggle Theme') }}</span></button>
            </li>


            {# Container for user-specific welcome message - populated by JS when logged in #}
            <li id="welcome-message-container" style="display: none; margin-right: 10px; color: white; align-self: center;"></li>

            {# Container for user dropdown (Profile, Logout) - shown by JS when logged in #}
            <li id="user-dropdown-container" style="display: none; position: relative; margin-left:auto;">
                <button id="user-dropdown-button" aria-haspopup="true" aria-expanded="false" style="background: none; border: none; color: white; font-size: 1em; cursor: pointer; padding: 10px; font-weight: bold; display:flex; align-items:center;">
                    <span class="user-icon" style="font-size:1.2em;">&#x1F464;</span><span class="dropdown-arrow"> &#9662;</span>
                </button>
                <div class="dropdown-menu" id="user-dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; background-color: #333; border: 1px solid #555; min-width: 160px; z-index: 1000; list-style-type: none; padding: 0; margin: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    <a class="dropdown-item" href="{{ url_for('serve_profile_page') }}" style="display: block; padding: 10px 15px; text-decoration: none; color: white;">{{ _('Profile') }}</a>
                    <a class="dropdown-item" href="{{ url_for('logout_and_redirect') }}" id="logout-link-dropdown" style="display: block; padding: 10px 15px; text-decoration: none; color: white;">{{ _('Logout') }}</a>
                </div>
            </li>
            {# Links for admin users or specific roles could be added here with appropriate checks #}
            {# Example: {% if current_user.is_admin %}<li><a href="{{ url_for('serve_admin_dashboard') }}">{{ _('Admin') }}</a></li>{% endif %} #}
        </ul>
    </nav>
    <div id="manual-backup-status" class="status-message" style="display:none; margin: 10px;"></div>
    <div id="main-content">
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    <footer>
        <p>{{ _('&copy; 2024 Smart Resource Booking') }}</p>
        <form id="language-form" method="get" style="margin-top:5px;">
            <label for="language-selector">{{ _('Language:') }}</label>
            <select name="lang" id="language-selector" onchange="this.form.submit()">
                {% for code in available_languages %}
                <option value="{{ code }}" {% if g.get('locale') == code %}selected{% endif %}>{{ code }}</option>
                {% endfor %}
            </select>
        </form>
        {% block footer_extra %}{% endblock %}
    </footer>
    </div>

    {% block scripts %}
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    {% endblock %}
</body>
</html>
