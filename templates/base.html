<!doctype html>
<html lang="{{ g.get('locale', 'en') }}">
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}{{ _('Smart Resource Booking') }}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block head_extra %}{% endblock %}
</head>
<body>
    <header class="app-header"><div class="header-content"></div></header>
    <nav id="sidebar" class="collapsed">
        <button id="sidebar-toggle" aria-label="{{ _('Toggle menu') }}">&#9776;</button>
        <ul>
            <li><a href="{{ url_for('serve_index') }}"><span class="menu-icon" aria-hidden="true">üè†</span><span class="menu-text">{{ _('Home') }}</span></a></li>
            <li><a href="{{ url_for('serve_resources') }}"><span class="menu-icon" aria-hidden="true">üìÅ</span><span class="menu-text">{{ _('View Resources') }}</span></a></li>
            <li><a href="{{ url_for('serve_calendar') }}"><span class="menu-icon" aria-hidden="true">üìÖ</span><span class="menu-text">{{ _('Calendar') }}</span></a></li>
            
            {# General links visible to all - JavaScript will manage the display of login/logout and user info #}

            {# Container for 'My Bookings' - shown by JS when logged in #}
            <li id="my-bookings-nav-link" style="display: none;">
                 <a href="{{ url_for('serve_my_bookings_page') }}"><span class="menu-icon" aria-hidden="true">üìñ</span><span class="menu-text">{{ _('My Bookings') }}</span></a>
            </li>
            
            {# Container for Admin Maps link - shown by JS if admin #}
        <li id="admin-menu-item" style="display:none;">
            <details id="admin-section">
                <summary><span class="menu-icon" aria-hidden="true">‚öôÔ∏è</span><span class="menu-text">{{ _('Admin') }}</span></summary>
                <ul class="admin-menu">
                <li id="admin-maps-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_admin_maps') }}">{{ _('Admin Maps') }}</a>
                </li>
                <li id="resource-management-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_resource_management_page') }}">{{ _('Resource Management') }}</a>
                </li>
                <li id="user-management-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_user_management_page') }}">{{ _('User Management') }}</a>
                </li>
                <li id="log-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_audit_log_page') }}">{{ _('Audit Logs') }}</a>
                </li>
                <li id="analytics-nav-link" style="display: none;">
                    <a href="{{ url_for('analytics.analytics_dashboard') }}">{{ _('Analytics') }}</a>
                </li>
                <li id="admin-bookings-nav-link" style="display: none;">
                    <a href="{{ url_for('serve_admin_bookings_page') }}">{{ _('Admin Bookings') }}</a>
                </li>
                <li id="manual-backup-nav-link" style="display:none;">
                    <button class="button" id="manual-backup-btn" type="button">{{ _('Manual Sync') }}</button>
                </li>
                </ul>
            </details>
        </li>

            {# Container for user-specific welcome message - populated by JS when logged in #}
            {# Container for user dropdown (Profile, Logout) - shown by JS when logged in #}
            {# Links for admin users or specific roles could be added here with appropriate checks #}
            {# Example: {% if current_user.is_admin %}<li><a href="{{ url_for('serve_admin_dashboard') }}">{{ _('Admin') }}</a></li>{% endif %} #}
        </ul>
    </nav>
    <div id="manual-backup-status" class="status-message" style="display:none; margin: 10px;"></div>
    <div id="main-content">
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    <footer>
        <div class="footer-accessibility-controls">
            <button id="theme-toggle" type="button"><span class="menu-icon" aria-hidden="true">üåì</span><span class="menu-text">{{ _('Toggle Theme') }}</span></button>
            <button id="toggle-high-contrast" type="button"><span class="menu-icon" aria-hidden="true">‚óê</span><span class="menu-text">{{ _('Toggle Contrast') }}</span></button>
            <button id="increase-font-size" type="button"><span class="menu-icon" aria-hidden="true">Aa+</span><span class="menu-text">{{ _('Increase Font') }}</span></button>
            <button id="decrease-font-size" type="button"><span class="menu-icon" aria-hidden="true">Aa-</span><span class="menu-text">{{ _('Decrease Font') }}</span></button>
            <button id="reset-font-size" type="button"><span class="menu-icon" aria-hidden="true">Aa</span><span class="menu-text">{{ _('Reset Font') }}</span></button>
        </div>
        <p>{{ _('&copy; 2024 Smart Resource Booking') }}</p>
        <form id="language-form" method="get" style="margin-top:5px;">
            <label for="language-selector">{{ _('Language:') }}</label>
            <select name="lang" id="language-selector" onchange="this.form.submit()">
                {% for code in available_languages %}
                <option value="{{ code }}" {% if g.get('locale') == code %}selected{% endif %}>{{ code }}</option>
                {% endfor %}
            </select>
        </form>
        {% block footer_extra %}{% endblock %}
    </footer>
    </div>

    {% block scripts %}
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    {% endblock %}
</body>
</html>
