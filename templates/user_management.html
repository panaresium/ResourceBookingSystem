{% extends "base.html" %}
{% import '_pagination_controls.html' as pagination_macros with context %} {# IMPORT ADDED HERE #}

{% block title %}{{ _('User Management - Smart Resource Booking') }}{% endblock %}

{% block content %}
    <h1>{{ _('User Management') }}</h1>

    <button id="add-new-user-btn" class="button">{{ _('Add New User') }}</button>
    <button id="bulk-user-actions-btn" class="button" style="margin-left:5px;">{{ _('Bulk Actions') }}</button>
    <button id="export-users-btn" class="button" style="margin-left:5px;">{{ _('Export Users') }}</button>
    <input type="file" id="import-users-file-input" accept=".csv, .json" style="display:none;">
    <button id="import-users-btn" class="button" style="margin-left:5px;">{{ _('Import Users') }}</button>


    <div class="filters-section" style="margin-top:15px; margin-bottom: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 5px;">
        <h3>{{ _('Filters') }}</h3>
        <label for="user-filter-username">{{ _('Username:') }}</label>
        <input type="text" id="user-filter-username" placeholder="{{ _('Filter by Username') }}" style="margin-right: 10px;">

        <label for="user-filter-email">{{ _('Email:') }}</label>
        <input type="text" id="user-filter-email" placeholder="{{ _('Filter by Email') }}" style="margin-right: 10px;">

        <label for="user-filter-role">{{ _('Role:') }}</label>
        <select id="user-filter-role" style="margin-right: 10px;">
            <option value="">{{ _('-- Any Role --') }}</option>
            {# Roles will be populated by JavaScript or could be hardcoded if static #}
        </select>

        <button id="user-apply-filters-btn" class="button primary">{{ _('Apply Filters') }}</button>
        <button id="user-clear-filters-btn" class="button">{{ _('Clear Filters') }}</button>
    </div>

    <div id="user-management-status" class="status-message" style="margin-top: 15px;"></div>

    {# JS PAGINATION CONTROLS ADDED HERE #}
    {{ pagination_macros.render_js_pagination_controls('user_pg_') }}

    {# SCROLLABLE CONTAINER ADDED HERE, WRAPPING existing responsive-table-container #}
    <div class="scrollable-table-container">
        <div class="responsive-table-container">
            <table id="users-table" class="styled-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all-users"></th>
                        <th>{{ _('ID') }}</th>
                        <th>{{ _('Username') }}</th>
                        <th>{{ _('Email') }}</th>
                        <th>{{ _('Admin Status') }}</th>
                        <th>{{ _('Roles') }}</th>
                        <th>{{ _('Google Connected') }}</th>
                        <th>{{ _('Actions') }}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- User rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div> {# END SCROLLABLE CONTAINER #}

    <!-- User Form Modal -->
    <div id="user-form-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal-btn" data-modal-id="user-form-modal">&times;</span>
            <h2 id="user-form-modal-title">{{ _('Add New User') }}</h2>
            <div id="user-form-modal-status" class="status-message"></div>
            <form id="user-form">
                <input type="hidden" id="user-id" name="id">
                <div>
                    <label for="username">{{ _('Username:') }}</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div>
                    <label for="email">{{ _('Email:') }}</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div>
                    <label for="password">{{ _('Password:') }}</label>
                    <input type="password" id="password" name="password">
                    <small id="password-hint">{{ _('Leave blank to keep current password (for edit). Required for new user.') }}</small>
                </div>
                <div>
                    <label for="is_admin">{{ _('Admin Status:') }}</label>
                    <input type="checkbox" id="is_admin" name="is_admin"> {{ _('Grant Admin Privileges') }}
                </div>
                <div>
                    <label for="roles">{{ _('Roles (comma-separated):') }}</label>
                    <input type="text" id="roles" name="roles" placeholder="{{ _('e.g., booking_manager,user_viewer') }}">
                </div>
                 <div>
                    <label for="google_id_status">{{ _('Google Account Status:') }}</label>
                    <p id="google_id_status" style="font-weight: normal;">{{ _('Not connected') }}</p>
                    <button type="button" id="disconnect-google-btn" class="button danger" style="display:none;">{{ _('Disconnect Google Account') }}</button>
                </div>
                <button type="submit" class="button primary">{{ _('Save User') }}</button>
            </form>
        </div>
    </div>

    <!-- Bulk User Actions Modal -->
    <div id="bulk-user-actions-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal-btn" data-modal-id="bulk-user-actions-modal">&times;</span>
            <h2>{{ _('Bulk User Actions') }}</h2>
            <div id="bulk-user-actions-status" class="status-message"></div>
            <form id="bulk-user-actions-form">
                <div>
                    <label for="bulk-action-type">{{ _('Action:') }}</label>
                    <select id="bulk-action-type" name="action_type">
                        <option value="">{{ _('-- Select Action --') }}</option>
                        <option value="set_admin">{{ _('Set as Admin') }}</option>
                        <option value="unset_admin">{{ _('Remove Admin') }}</option>
                        <option value="add_roles">{{ _('Add Roles') }}</option>
                        <option value="remove_roles">{{ _('Remove Roles') }}</option>
                        <option value="delete_users">{{ _('Delete Users') }}</option>
                    </select>
                </div>
                <div id="bulk-roles-input-container" style="display:none;">
                    <label for="bulk-roles-input">{{ _('Roles (comma-separated):') }}</label>
                    <input type="text" id="bulk-roles-input" name="roles_to_modify" placeholder="{{ _('e.g., role1,role2') }}">
                </div>
                <button type="submit" class="button primary">{{ _('Apply Bulk Action') }}</button>
            </form>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/user_management.js') }}" defer></script>
{% endblock %}
